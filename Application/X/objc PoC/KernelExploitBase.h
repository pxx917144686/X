// KernelExploitBase.h
#ifndef KernelExploitBase_h
#define KernelExploitBase_h

#import <Foundation/Foundation.h>
#import <UIKit/UIKit.h>
#import <unistd.h>
#import <mach/mach.h>
#import <dlfcn.h>

// 内核结构偏移
#define OFFSET_MOUNTLIST       0x1000
#define OFFSET_MOUNT_FROMNAME  0x200
#define OFFSET_MOUNT_FLAGS     0x70

// MNT标志
#define MNT_RDONLY   0x00000001
#define MNT_ROOTFS   0x00004000

// 内核函数偏移
#define KERNEL_FUNC_COPYIN   0x1A1A1A1A
#define KERNEL_FUNC_COPYOUT  0x2B2B2B2B

// 全局状态变量
extern bool g_has_kernel_access;
extern uint64_t g_kernel_base;
extern uint64_t g_kernel_slide;
extern io_connect_t g_global_connection;
extern int g_kernel_read_method;
extern int g_kernel_write_method;

// 核心功能函数
mach_port_t IOKitGetMainPort(void);
uint64_t get_kernel_base(void);
bool test_kernel_memory_access(void);
bool initialize_exploit_environment(void);
bool verify_real_jailbreak_status(void);

// 进程操作函数
uint64_t find_proc_by_pid(int pid);
bool modify_process_credentials(uint64_t proc);
bool escalate_to_root(void);

#endif /* KernelExploitBase_h */
